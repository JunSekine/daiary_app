<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥ã€…ã®è¨˜éŒ²</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .diary-entry {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .todo-item {
            display: flex;
            align-items: center; /* ç¸¦ã®ä¸­å¤®å¯„ã› */
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .todo-header {
            font-weight: bold;
            margin-top: 20px;
        }

        .todo-text {
            flex-grow: 1; /* ã‚¿ã‚¹ã‚¯åã‚’æ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã«åºƒã’ã‚‹ */
            margin-left: 10px; /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¨ã‚¿ã‚¹ã‚¯åã®é–“ã«é©åº¦ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’ä»˜åŠ  */
            text-align: left; /* ã‚¿ã‚¹ã‚¯åã‚’å·¦å¯„ã› */
        }
    </style>
</head>

<body>
<div class="container">
    <h1>æ—¥ã€…ã®è¨˜éŒ²</h1>

    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="diary-tab" data-toggle="tab" href="#diary" role="tab" aria-controls="diary"
               aria-selected="true">æ—¥è¨˜</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="todo-tab" data-toggle="tab" href="#todo" role="tab" aria-controls="todo"
               aria-selected="false">ToDoãƒªã‚¹ãƒˆ</a>
        </li>
    </ul>

    <!-- ã‚¿ãƒ–å†…å®¹ -->
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="diary" role="tabpanel" aria-labelledby="diary-tab">
            <form id="diaryForm">
                <div class="form-group">
                    <label for="date">æ—¥ä»˜:</label>
                    <input type="date" class="form-control" id="date" required>
                </div>
                <div class="form-group">
                    <label for="weather">å¤©æ°—:</label>
                    <select class="form-control" id="weather">
                        <option>æ™´ã‚Œ</option>
                        <option>æ›‡ã‚Š</option>
                        <option>é›¨</option>
                        <option>é›ª</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="mood">æ„Ÿæƒ…:</label>
                    <select class="form-control" id="mood">
                        <option value="ğŸ˜Š: å¹¸ã›">ğŸ˜Š: å¹¸ã›</option>
                        <option value="ğŸ˜¢: æ‚²ã—ã„">ğŸ˜¢: æ‚²ã—ã„</option>
                        <option value="ğŸ˜¡: æ€’ã‚Š">ğŸ˜¡: æ€’ã‚Š</option>
                        <option value="ğŸ˜: æ™®é€š">ğŸ˜: æ™®é€š</option>
                        <option value="ğŸ˜…: ç¬‘ã„">ğŸ˜…: ç¬‘ã„</option>
                        <option value="ğŸ˜Œ: ã»ã£ã¨ã—ãŸ">ğŸ˜Œ: ã»ã£ã¨ã—ãŸ</option>
                        <option value="ğŸ¤”: è€ƒãˆä¸­">ğŸ¤”: è€ƒãˆä¸­</option>
                        <option value="ğŸ˜³: é©šã">ğŸ˜³: é©šã</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="entry">æ—¥è¨˜ã®è¨˜éŒ²:</label>
                    <textarea class="form-control" id="entry" rows="5" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">è¨˜éŒ²ã‚’ä¿å­˜</button>
                <button id="cancelEditButton" class="btn btn-secondary" style="display: none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </form>

            <button id="deleteAllButton" class="btn btn-danger mt-3">ã™ã¹ã¦ã®è¨˜éŒ²ã‚’å‰Šé™¤</button>
            <div id="message" class="mt-3"></div>

            <h2 class="mt-5">ä¿å­˜ã—ãŸè¨˜éŒ²</h2>
            <div id="diaryEntries"></div>
        </div>

        <div class="tab-pane fade" id="todo" role="tabpanel" aria-labelledby="todo-tab">
            <form id="todoForm">
                <div class="form-group">
                    <label for="todoDate">æ—¥ä»˜:</label>
                    <input type="date" class="form-control" id="todoDate" value="${new Date().toISOString().substring(0, 10)}" required>
                </div>
                <div class="form-group">
                    <label for="todoType">ã‚¿ã‚¹ã‚¯ã®ç¨®é¡:</label>
                    <input type="text" class="form-control" id="todoType" placeholder="ã‚¿ã‚¹ã‚¯ã®ç¨®é¡ã‚’å…¥åŠ›" required>
                </div>
                <div class="form-group">
                    <label for="todoInput">ã‚¿ã‚¹ã‚¯:</label>
                    <input type="text" class="form-control" id="todoInput" placeholder="ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã™ã‚‹" required>
                </div>
                <button type="submit" class="btn btn-success">è¿½åŠ </button>
            </form>
            <div id="todoList"></div>
            <button id="deleteAllTodosButton" class="btn btn-danger mt-3">ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤</button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // æ—¥è¨˜ã‚¢ãƒ—ãƒªæ©Ÿèƒ½
    document.getElementById('diaryForm').addEventListener('submit', function (event) {
        event.preventDefault();
        if (isEditing) return; // ä¿®æ­£ä¸­ã§ã‚ã‚Œã°ä¿å­˜ã‚’ç„¡åŠ¹ã«

        saveDiaryEntry();
    });

    let isEditing = false;
    let editingIndex = null;

    function saveDiaryEntry() {
        const date = document.getElementById('date').value;
        const weather = document.getElementById('weather').value;
        const mood = document.getElementById('mood').value.split(': ')[0];
        const entry = document.getElementById('entry').value;

        const diaryEntry = { date, weather, mood, entry };

        let entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        if (isEditing) {
            entries[editingIndex] = diaryEntry; // ä¿®æ­£ã®å ´åˆã€ä¸Šæ›¸ã
        } else {
            entries.push(diaryEntry); // æ–°è¦è¿½åŠ 
        }
        localStorage.setItem('diaryEntries', JSON.stringify(entries));

        clearDiaryForm();
        displayEntries(); // è¡¨ç¤ºã‚’æ›´æ–°
        document.getElementById('message').innerText = isEditing ? 'è¨˜éŒ²ãŒä¿®æ­£ã•ã‚Œã¾ã—ãŸï¼' : 'è¨˜éŒ²ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸï¼';
    }

    function displayEntries() {
        const entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        const diaryEntriesDiv = document.getElementById('diaryEntries');
        diaryEntriesDiv.innerHTML = '';

        entries.forEach((entry, index) => {
            const entryDiv = document.createElement('div');
            entryDiv.className = 'diary-entry';
            entryDiv.innerHTML = `
                <strong>${entry.date}</strong> <br>
                å¤©æ°—: ${entry.weather} <br>
                æ„Ÿæƒ…: ${entry.mood} <br>
                <p>${entry.entry}</p>
                <button class="btn btn-secondary edit-entry" data-index="${index}">ä¿®æ­£</button>
                <button class="btn btn-danger delete-entry" data-index="${index}">å‰Šé™¤</button>
            `;
            diaryEntriesDiv.appendChild(entryDiv);
        });

        const deleteButtons = document.querySelectorAll('.delete-entry');
        deleteButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const index = event.target.getAttribute('data-index');
                deleteEntry(index);
            });
        });

        const editButtons = document.querySelectorAll('.edit-entry');
        editButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const index = event.target.getAttribute('data-index');
                editEntry(index);
            });
        });
    }

    function editEntry(index) {
        let entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        const entry = entries[index];

        document.getElementById('date').value = entry.date;
        document.getElementById('weather').value = entry.weather;
        document.getElementById('mood').value = entry.mood + ': ' + (entry.mood === 'ğŸ˜Š' ? 'å¹¸ã›' :
            entry.mood === 'ğŸ˜¢' ? 'æ‚²ã—ã„' :
            entry.mood === 'ğŸ˜¡' ? 'æ€’ã‚Š' :
            entry.mood === 'ğŸ˜' ? 'æ™®é€š' :
            entry.mood === 'ğŸ˜…' ? 'ç¬‘ã„' :
            entry.mood === 'ğŸ˜Œ' ? 'ã»ã£ã¨ã—ãŸ' :
            entry.mood === 'ğŸ¤”' ? 'è€ƒãˆä¸­' :
            'é©šã');
        document.getElementById('entry').value = entry.entry;

        isEditing = true;
        editingIndex = index;
        document.getElementById('cancelEditButton').style.display = 'inline'; //ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
    }

    function clearDiaryForm() {
        document.getElementById('diaryForm').reset();
        isEditing = false;
        editingIndex = null;
        document.getElementById('cancelEditButton').style.display = 'none'; //ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
    }

    function deleteEntry(index) {
        let entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        entries.splice(index, 1);
        localStorage.setItem('diaryEntries', JSON.stringify(entries));
        displayEntries();
    }

    document.getElementById('deleteAllButton').addEventListener('click', function () {
        const confirmDelete = confirm("ã™ã¹ã¦ã®è¨˜éŒ²ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ");
        if (confirmDelete) {
            localStorage.removeItem('diaryEntries');
            displayEntries();
            document.getElementById('message').innerText = 'ã™ã¹ã¦ã®è¨˜éŒ²ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚';
        }
    });

    document.getElementById('cancelEditButton').addEventListener('click', function (event) {
        event.preventDefault();
        clearDiaryForm(); //ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
    });

    // ToDoãƒªã‚¹ãƒˆæ©Ÿèƒ½
    document.getElementById('todoForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const todoInput = document.getElementById('todoInput').value;
        const todoType = document.getElementById('todoType').value;
        const todoDate = document.getElementById('todoDate').value;
        addTodoItem(todoInput, todoType, todoDate);
        document.getElementById('todoInput').value = ''; // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
        document.getElementById('todoDate').value = ''; // æ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
        document.getElementById('todoType').value = ''; // ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
    });

    function addTodoItem(task, type, date) {
        const todoList = JSON.parse(localStorage.getItem('todoList')) || [];
        todoList.push({ task, type, date, completed: false }); // å®Œäº†çŠ¶æ…‹ã‚’è¿½åŠ 
        localStorage.setItem('todoList', JSON.stringify(todoList));

        displayTodoList(); // è¡¨ç¤ºã‚’æ›´æ–°
    }

    function displayTodoList() {
        const todoList = JSON.parse(localStorage.getItem('todoList')) || [];
        const todoListDiv = document.getElementById('todoList');
        todoListDiv.innerHTML = ''; // æ—¢å­˜ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢

        // ã‚¿ã‚¹ã‚¯ã®ç¨®é¡ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
        const groupedTodos = todoList.reduce((accumulator, item) => {
            if (!accumulator[item.date]) {
                accumulator[item.date] = {};
            }
            if (!accumulator[item.date][item.type]) {
                accumulator[item.date][item.type] = [];
            }
            accumulator[item.date][item.type].push(item);
            return accumulator;
        }, {});

        for (const date in groupedTodos) {
            // æ—¥ä»˜ã®è¦‹å‡ºã—ã‚’è¿½åŠ 
            const dateHeader = document.createElement('h5');
            dateHeader.innerText = date;
            todoListDiv.appendChild(dateHeader);

            for (const type in groupedTodos[date]) {
                // ã‚¿ã‚¹ã‚¯ã®ç¨®é¡ã®è¦‹å‡ºã—ã‚’è¿½åŠ 
                const typeHeader = document.createElement('div');
                typeHeader.className = 'todo-header';
                typeHeader.innerText = type;
                todoListDiv.appendChild(typeHeader);

                groupedTodos[date][type].forEach((item, index) => {
                    const todoItemDiv = document.createElement('div');
                    todoItemDiv.className = 'todo-item';
                    todoItemDiv.innerHTML = `
                        <input type="checkbox" class="todo-checkbox" data-index="${todoList.indexOf(item)}" ${item.completed ? 'checked' : ''}>
                        <span class="todo-text">${item.task}</span> <!-- ã‚¿ã‚¹ã‚¯åã‚’å·¦å¯„ã› -->
                        <button class="btn btn-danger delete-todo" data-index="${todoList.indexOf(item)}">å‰Šé™¤</button>
                    `;
                    todoListDiv.appendChild(todoItemDiv);
                });
            }
        }

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        const checkboxButtons = document.querySelectorAll('.todo-checkbox');
        checkboxButtons.forEach(checkbox => {
            checkbox.addEventListener('change', (event) => {
                const index = event.target.getAttribute('data-index');
                toggleTodoCompletion(index);
            });
        });

        const deleteTodoButtons = document.querySelectorAll('.delete-todo');
        deleteTodoButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const index = event.target.getAttribute('data-index');
                deleteTodoItem(index);
            });
        });
    }

    function toggleTodoCompletion(index) {
        const todoList = JSON.parse(localStorage.getItem('todoList')) || [];
        todoList[index].completed = !todoList[index].completed; // å®Œäº†çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«
        localStorage.setItem('todoList', JSON.stringify(todoList));
        displayTodoList(); // å†è¡¨ç¤º
    }

    function deleteTodoItem(index) {
        const todoList = JSON.parse(localStorage.getItem('todoList')) || [];
        todoList.splice(index, 1);
        localStorage.setItem('todoList', JSON.stringify(todoList));
        displayTodoList(); // å†è¡¨ç¤º
    }

    document.getElementById('deleteAllTodosButton').addEventListener('click', function () {
        const confirmDelete = confirm("ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ");
        if (confirmDelete) {
            localStorage.removeItem('todoList');
            displayTodoList(); // å†è¡¨ç¤º
            document.getElementById('message').innerText = 'ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚';
        }
    });

    // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã¨ãã«æ—¢å­˜ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¨ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
    window.onload = function () {
        displayEntries();
        displayTodoList();
    };
</script>
</body>

</html>
